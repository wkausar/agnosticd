---
- name: set namespace
  set_fact:
    _namespace: "{{ namespace_prefix }}{{ user_num }}"

- name: "create namespace {{ _namespace }}"
  k8s:
    state: present
    definition: "{{ lookup('template', role_path ~ '/templates/namespace.j2' ) | from_yaml }}"

- name: Create quota in namespace {{ _namespace }}
  k8s:
    state: present
    namespace: "{{ _namespace }}"
    definition: "{{ lookup('file', role_path ~ '/files/namespace-quota.yml' ) | from_yaml }}"

- name: Create limits in namespace {{ _namespace }}
  k8s:
    state: present
    namespace: "{{ _namespace }}"
    definition: "{{ lookup('file', role_path ~ '/files/namespace-limits.yml' ) | from_yaml }}"

- name: "give user user{{ user_num }} admin rights in namespace {{ _namespace }}"
  k8s:
    state: present
    namespace: "{{ _namespace }}"
    definition: "{{ lookup('template', role_path ~ '/templates/namespace-admin-rb.j2' ) | from_yaml }}"

- name: "Strimzi workload for user user{{ user_num }}"
  include_tasks: workload_per_project_strimzi.yml

- name: "Infinispan workload for user user{{ user_num }}"
  include_tasks: workload_per_project_infinispan.yml

- name: "Kogito workload for user user{{ user_num }}"
  include_tasks: workload_per_project_kogito.yml

- name: "Infinispan cluster workload for user user{{ user_num }}"
  include_tasks: workload_per_project_infinispan_cluster.yml

- name: "Kafka cluster workload for user user{{ user_num }}"
  include_tasks: workload_per_project_kafka_cluster.yml

- name: Gitea for {{ _namespace }}
  include_tasks: workload_per_project_gitea.yml

- name: CoreReadyWorkspaces for {{ _namespace }}
  include_tasks: workload_per_project_codereadyworkspaces.yml
